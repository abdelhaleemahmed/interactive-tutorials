<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุทุฑููุฉ ุงูุชูุงุนููุฉ - ุฏุฑูุณ ุฅุฏุงุฑุฉ ููููุณ</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/xterm.css" />
</head>
<body>
    <div class="container">
        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb">
            <a href="https://abdelhaleemahmed.github.io/">ุงููุนุฑุถ</a> /
            <a href="https://abdelhaleemahmed.github.io/interactive-tutorials/">ุงูุฏุฑูุณ ุงูุชุนููููุฉ</a> /
            <a href="./index.html">ุฅุฏุงุฑุฉ ููููุณ</a> /
            <span>Interactive Terminal</span>
        </nav>

        <!-- Header -->
        <header class="tutorial-header">
            <h1>๐ ุงูุทุฑููุฉ ุงูุชูุงุนููุฉ</h1>
            <p class="subtitle">ูุงุฑุณ ุฃูุงูุฑ ููููุณ ูู ุจูุฆุฉ ูุญุงูุงุฉ ุขููุฉ</p>
        </header>

        <!-- Content Section -->
        <section class="content-section">
            <h2>ุทุฑููุชู ุงูุชูุงุนููุฉ</h2>
            <p>ุฃุฏูุงู ุทุฑููุฉ ููููุณ ูุญุงูุงุฉ ุชุชุตุฑู ูุซู ุทุฑููุฉ ุญููููุฉ ููุฃูุงูุฑ ุงูุฃุณุงุณูุฉ. ูุง ุชุชุฑุฏุฏ ูู ูุชุงุจุฉ ุงูุฃูุงูุฑ ูุงูุถุบุท ุนูู Enter ูุฑุคูุฉ ุงููุงุชุฌ. ุชุฐูุฑุ ูุฐู ูุญุงูุงุฉุ ูุฐูู ูุง ูุชู ุฅุฌุฑุงุก ุชุบููุฑุงุช ุญููููุฉ ุนูู ุฌูุงุฒ ุงูููุจููุชุฑ ุงูุฎุงุต ุจู.</p>

            <div class="info-box">
                <h4>ุงูุจุฏุก</h4>
                <ul>
                    
                    <li>{ุงุณุชุฎุฏู <strong>ููุงุชูุญ ุงูุฃุณูู ูุฃุนูู/ูุฃุณูู</strong> ููุชููู ูู ุณุฌู ุงูุฃูุงูุฑ}</li>
                    
                    <li>{ุงุถุบุท <strong>Tab</strong> ููุฅููุงู ุงูุชููุงุฆู ููุฃูุงูุฑ ูุฃุณูุงุก ุงููููุงุช/ุงููุฌูุฏุงุช}</li>
                    
                    <li>{ุงูุชุจ <code>help</code> ูุฑุคูุฉ ูุฑุฌุน ุณุฑูุน ูุฌููุน ุงูุฃูุงูุฑ ุงููุฏุนููุฉ}</li>
                    
                    <li>{ุงูุชุจ <code>clear</code> ููุณุญ ุดุงุดุฉ ุงูุทุฑููุฉ}</li>
                    
                </ul>
            </div>
        </section>

        <!-- Embedded Interactive Terminal -->
        <div class="terminal-wrapper">
            <div id="terminal"></div>
        </div>

        <section class="content-section">
            <h2>ุฌุฑุจ ูุฐู ุงูุฃูุงูุฑ</h2>
            <p>ุฅููู ุจุนุถ ุงูุฃูุงูุฑ ุงูุดุงุฆุนุฉ ููุจุฏุก. ุฌุฑุจูุง ูู ุงูุทุฑููุฉ ุฃุนูุงู!</p>

            
            <div class="command-example">
                <h4>ุงูุชููู</h4>
                <pre><code>pwd              # ุทุจุงุนุฉ ุงููุฌูุฏ ุงูุญุงูู
ls               # ุณุฑุฏ ุงููููุงุช ูุงููุฌูุฏุงุช
cd documents     # ุงูุงูุชูุงู ุฅูู ูุฌูุฏ documents
cd ..            # ุงูุนูุฏุฉ ูุฌูุฏ ูุงุญุฏ ููุฃุนูู
cd ~             # ุงูุฐูุงุจ ุฅูู ุงููุฌูุฏ ุงูุฑุฆูุณู</code></pre>
            </div>
            
            <div class="command-example">
                <h4>ุนูููุงุช ุงููููุงุช</h4>
                <pre><code>cat README.txt   # ุนุฑุถ ูุญุชููุงุช ุงูููู
mkdir test       # ุฅูุดุงุก ูุฌูุฏ
touch file.txt   # ุฅูุดุงุก ููู ูุงุฑุบ
cp file.txt copy.txt  # ูุณุฎ ููู
mv file.txt newname.txt  # ููู/ุฅุนุงุฏุฉ ุชุณููุฉ ููู
rm newname.txt   # ุญุฐู ููู</code></pre>
            </div>
            
            <div class="command-example">
                <h4>ุงููุนูููุงุช</h4>
                <pre><code>help             # ุฅุธูุงุฑ ุงูุฃูุงูุฑ ุงููุชุงุญุฉ
man ls           # ุฏููู ุงุณุชุฎุฏุงู ุฃูุฑ ls
whoami           # ุฅุธูุงุฑ ุงููุณุชุฎุฏู ุงูุญุงูู
date             # ุฅุธูุงุฑ ุงูุชุงุฑูุฎ/ุงูููุช ุงูุญุงูู
uptime           # ุฅุธูุงุฑ ููุช ุชุดุบูู ุงููุธุงู</code></pre>
            </div>
            
        </section>

        <section class="content-section">
            <h2>ุฌุฑุจ ูุชุนูู!</h2>
            <p>ูุฐู ุงูุทุฑููุฉ ุงูุชูุงุนููุฉ ูู ุตูุฏูู ุฑูู ูู ููุนุจ ููู. ูุง ุชุฎู ูู ุชุฌุฑุจุฉ ุงูุฃูุงูุฑ ูุงุฑุชูุงุจ ุงูุฃุฎุทุงุก ูุงูุชุนูู ูููุง. ูููุง ูุงุฑุณุช ุฃูุซุฑุ ูููุง ุฃุตุจุญุช ุฃูุซุฑ ุฑุงุญุฉ ูููุฉ ูุน ุณุทุฑ ุฃูุงูุฑ ููููุณ.</p>

            <div class="warning-box">
                <h4>๐ ุชุฑูุฏ ูุนุฑูุฉ ุงููุฒูุฏุ</h4>
                <p>ุงุฑุฌุน ุฅูู ูุญุฏุงุช ุงูุฏุฑูุณ ูุชุนูู ููุงุถูุน ูุญุฏุฏุฉ ุจุนูู:</p>
                <ul>
                    
                    <li><a href="./basic-commands.html">ุงูุฃูุงูุฑ ุงูุฃุณุงุณูุฉ ูุงูุชููู</a></li>
                    
                    <li><a href="./file-system.html">ุฅุฏุงุฑุฉ ูุธุงู ุงููููุงุช</a></li>
                    
                    <li><a href="./user-management.html">ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช</a></li>
                    
                    <li><a href="./system-admin.html">ุฅุฏุงุฑุฉ ุงููุธุงู</a></li>
                    
                </ul>
            </div>
        </section>

        <!-- Page Navigation -->
        <nav class="page-navigation">
            <a href="./system-admin.html" class="nav-button prev">ุฅุฏุงุฑุฉ ุงููุธุงู</a>
            <a href="./index.html" class="nav-button next">ุงูุนูุฏุฉ ุฅูู ุงููุธุฑุฉ ุงูุนุงูุฉ</a>
        </nav>
    </div>

    <!-- Theme Selector (3 themes: Light, Dark, Terminal) -->
    <div class="theme-selector">
    
    <!-- Language Selector -->
    <div class="language-selector">
        <div class="lang-btn en active" title="English" data-lang="en">EN</div>
        <!-- Future languages can be added here -->
        <div class="lang-btn ar" title="ุงูุนุฑุจูุฉ" data-lang="ar">AR</div>
    </div>
        <div class="theme-btn light active" title="Light Theme"></div>
    
    <!-- Language Selector -->
    <div class="language-selector">
        <div class="lang-btn en active" title="English" data-lang="en">EN</div>
        <!-- Future languages can be added here -->
        <div class="lang-btn ar" title="ุงูุนุฑุจูุฉ" data-lang="ar">AR</div>
    </div>
        <div class="theme-btn dark" title="Dark Theme"></div>
        <div class="theme-btn terminal" title="Terminal Theme"></div>
    </div>

    <!-- Footer -->
    <footer class="tutorial-footer">
        <p>ยฉ 2025 ุฃุญูุฏ ุนุจุฏ ุงูุญููู | <a href="https://abdelhaleemahmed.github.io/">ุงูุนูุฏุฉ ุฅูู ุงููุนุฑุถ</a></p>
    </footer>

    <!-- Terminal Scripts -->
    <script src="../js/xterm.js"></script>
    <script src="../js/xterm-addon-fit.js"></script>

    <!-- Import modular command logic -->
    <script type="module">
        import { commandHandlers } from '../js/commandRegistry.js';
        import { writePrompt, currentPath, getCurrentDir, resolvePath, getPathObject, updateCurrentPath } from '../js/terminalUtils.js';
        import { ShellParser } from '../js/shellParser.js';
        import { getCommandNotFoundMessage, validateCommand } from '../js/commandSuggestions.js';

        document.addEventListener('DOMContentLoaded', () => {
            const terminalContainer = document.getElementById('terminal');
            const term = new Terminal({
                cursorBlink: true,
                convertEol: true,
                fontFamily: 'Courier New, Courier, monospace',
                fontSize: 14,
                theme: {
                    background: '#1e1e1e',
                    foreground: '#abb2bf',
                    cursor: '#abb2bf',
                    selection: 'rgba(128, 128, 128, 0.4)',
                    black: '#21252b',
                    red: '#e06c75',
                    green: '#98c379',
                    yellow: '#e5c07b',
                    blue: '#61afef',
                    magenta: '#c678dd',
                    cyan: '#56b6c2',
                    white: '#abb2bf',
                    brightBlack: '#5c6370',
                    brightRed: '#e06c75',
                    brightGreen: '#98c379',
                    brightYellow: '#e5c07b',
                    brightBlue: '#61afef',
                    brightMagenta: '#c678dd',
                    brightCyan: '#56b6c2',
                    brightWhite: '#ffffff'
                }
            });

            const fitAddon = new FitAddon.FitAddon();
            term.loadAddon(fitAddon);
            term.open(terminalContainer);
            fitAddon.fit();
            window.addEventListener('resize', () => {
                fitAddon.fit();
            });

            // Initialize command handlers with the term instance
            const handlers = commandHandlers(term);
            const parser = new ShellParser();

            let currentCommand = '';
            const commandHistory = [];
            let historyIndex = -1;
            let cursorPos = 0;

            function handleCommand(command) {
                let output = '';

                // Strip comments (everything after #)
                const commentIndex = command.indexOf('#');
                if (commentIndex !== -1) {
                    command = command.substring(0, commentIndex).trim();
                }

                // Skip empty commands
                if (!command) {
                    return;
                }

                if (parser.needsShellParsing(command)) {
                    output = handlePipedCommand(command);
                } else {
                    const parts = command.split(/\s+/).filter(p => p.length > 0);
                    const cmd = parts[0];
                    const args = parts.slice(1);

                    const handler = handlers[cmd];

                    if (handler) {
                        output = handler(args);
                    } else if (cmd === '') {
                        output = '';
                    } else {
                        output = getCommandNotFoundMessage(cmd, handlers);
                    }
                }

                if (output) {
                    term.write(output + '\r\n');
                }
            }

            function handlePipedCommand(commandLine) {
                const parsed = parser.parse(commandLine);
                const { commands, redirections } = parsed;

                let output = '';

                for (let i = 0; i < commands.length; i++) {
                    const cmd = commands[i];
                    const handler = handlers[cmd.name];

                    if (!handler) {
                        return `bash: ${cmd.name}: command not found`;
                    }

                    try {
                        if (i === 0) {
                            output = handler(cmd.args);
                        } else {
                            output = executePipeStep(handler, cmd, output);
                        }
                    } catch (error) {
                        return `Error executing ${cmd.name}: ${error.message}`;
                    }
                }

                if (redirections.output) {
                    return `Output redirected to: ${redirections.output}`;
                } else if (redirections.append) {
                    return `Output appended to: ${redirections.append}`;
                }

                return output;
            }

            function executePipeStep(handler, cmd, pipeInput) {
                const cmdName = cmd.name;
                const pipeableCommands = ['grep', 'sort', 'uniq', 'wc', 'head', 'tail'];

                if (pipeableCommands.includes(cmdName)) {
                    return executePipeableCommand(handler, cmd, pipeInput);
                } else {
                    return handler(cmd.args);
                }
            }

            function executePipeableCommand(handler, cmd, pipeInput) {
                const lines = pipeInput.split('\n').filter(l => l.trim());

                if (cmd.name === 'grep') {
                    const pattern = cmd.args[0];
                    return lines.filter(l => l.includes(pattern)).join('\r\n');
                } else if (cmd.name === 'sort') {
                    const reverse = cmd.args.includes('-r');
                    let sorted = [...lines];
                    sorted.sort((a, b) => reverse ? b.localeCompare(a) : a.localeCompare(b));
                    return sorted.join('\r\n');
                } else if (cmd.name === 'wc') {
                    return lines.length.toString().padStart(7);
                }

                return handler(cmd.args);
            }

            function redrawLine() {
                term.write('\x1B[2K\r');
                writePrompt(term);
                term.write(currentCommand);
                const charsAfterCursor = currentCommand.length - cursorPos;
                if (charsAfterCursor > 0) {
                    term.write(`\x1B[${charsAfterCursor}D`);
                }
            }

            term.onData(e => {
                const charCode = e.charCodeAt(0);

                if (e === '\r') {
                    term.write('\r\n');
                    if (currentCommand.trim().length > 0) {
                        commandHistory.push(currentCommand.trim());
                        historyIndex = commandHistory.length;
                    }
                    handleCommand(currentCommand.trim());
                    currentCommand = '';
                    cursorPos = 0;
                    writePrompt(term);
                } else if (e === '\x7F') {
                    if (cursorPos > 0) {
                        currentCommand = currentCommand.slice(0, cursorPos - 1) + currentCommand.slice(cursorPos);
                        cursorPos--;
                        redrawLine();
                    }
                } else if (e === '\x1B[A') {
                    if (historyIndex > 0) {
                        historyIndex--;
                        currentCommand = commandHistory[historyIndex];
                        cursorPos = currentCommand.length;
                        redrawLine();
                    }
                } else if (e === '\x1B[B') {
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        currentCommand = commandHistory[historyIndex];
                        cursorPos = currentCommand.length;
                        redrawLine();
                    } else if (historyIndex === commandHistory.length - 1) {
                        historyIndex = commandHistory.length;
                        currentCommand = '';
                        cursorPos = 0;
                        redrawLine();
                    }
                } else if (e === '\x1B[C') {
                    if (cursorPos < currentCommand.length) {
                        cursorPos++;
                        term.write('\x1B[C');
                    }
                } else if (e === '\x1B[D') {
                    if (cursorPos > 0) {
                        cursorPos--;
                        term.write('\x1B[D');
                    }
                } else if (e === '\t') {
                    const currentDir = getCurrentDir();
                    if (!currentDir || !currentDir.children) return;

                    const commandParts = currentCommand.split(/\s+/);
                    const lastPart = commandParts.pop() || '';
                    const itemsInDir = Object.keys(currentDir.children);

                    const matches = itemsInDir.filter(item => item.startsWith(lastPart));

                    if (matches.length === 1) {
                        const completion = matches[0].substring(lastPart.length);
                        term.write(completion);
                        currentCommand += completion;
                        cursorPos = currentCommand.length;
                        if (currentDir.children[matches[0]].type === 'directory') {
                            term.write('/');
                            currentCommand += '/';
                            cursorPos = currentCommand.length;
                        }
                    } else if (matches.length > 1) {
                        term.write('\r\n');
                        term.write(matches.join('\t') + '\r\n');
                        writePrompt(term);
                        term.write(currentCommand);
                        cursorPos = currentCommand.length;
                    }
                }
                else if (charCode >= 32 && charCode <= 126) {
                    currentCommand = currentCommand.slice(0, cursorPos) + e + currentCommand.slice(cursorPos);
                    cursorPos++;
                    redrawLine();
                }
            });

            term.write('ูุฑุญุจุงู ุจู ูู ุทุฑููุฉ ููููุณ ุงููุญุงูุงุฉ!\r\n');
            term.write('ุงูุชุจ "help" ูุฑุคูุฉ ุงูุฃูุงูุฑ ุงููุชุงุญุฉ.\r\n\r\n');
            writePrompt(term);
        });
    </script>

    <!-- Enhanced Features -->
    <script src="../css/theme.js"></script>
    <script src="../css/language-switcher.js"></script>
    <script src="../css/shortcuts.js"></script>
    <script src="../css/cheatsheet.js"></script>
    <script src="../css/code-interactive.js"></script>
</body>
</html>
